<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BotBox ‚Üí Moxfield Converter</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Playfair+Display:wght@700;900&display=swap');
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #0c0d10; --surface: #13151a; --border: #1e2028;
    --text: #d8d4cc; --muted: #6a6860; --purple: #9b6dff;
    --purple-dim: rgba(155,109,255,0.12); --gold: #d4a840;
    --gold-dim: rgba(212,168,64,0.12); --green: #5dba7a;
    --green-dim: rgba(93,186,122,0.1);
  }
  html, body { background: var(--bg); color: var(--text); font-family: 'DM Mono', monospace; min-height: 100vh; }
  body { background-image: radial-gradient(ellipse 70% 50% at 10% 20%, rgba(100,50,200,0.07) 0%, transparent 60%), radial-gradient(ellipse 50% 70% at 90% 80%, rgba(200,140,30,0.05) 0%, transparent 60%); }
  .wrap { max-width: 780px; margin: 0 auto; padding: 56px 24px 80px; }
  h1 { font-family: 'Playfair Display', serif; font-size: clamp(28px,5vw,44px); font-weight: 900; background: linear-gradient(120deg,#b08aff 0%,#d4a840 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1; margin-bottom: 8px; }
  .tagline { font-size: 11px; letter-spacing: 0.14em; color: var(--muted); margin-bottom: 48px; text-transform: uppercase; }

  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 28px; margin-bottom: 20px; }
  .card-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 700; color: #e8e0d0; margin-bottom: 16px; }

  /* Pack name input */
  .field-label { font-size: 11px; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; }
  input[type=text] {
    width: 100%; background: #080a0e; border: 1px solid var(--border); border-radius: 7px;
    padding: 11px 14px; color: var(--text); font-family: 'DM Mono', monospace; font-size: 13px;
    outline: none; transition: border-color 0.2s; margin-bottom: 20px;
  }
  input[type=text]:focus { border-color: var(--purple); }

  /* Textarea */
  textarea {
    width: 100%; background: #080a0e; border: 1px solid var(--border); border-radius: 7px;
    padding: 14px; color: #a0d0a0; font-family: 'DM Mono', monospace; font-size: 12.5px;
    line-height: 1.7; outline: none; resize: vertical; transition: border-color 0.2s;
    min-height: 220px;
  }
  textarea:focus { border-color: var(--purple); }
  textarea::placeholder { color: #3a3830; }

  /* Buttons */
  .btn-row { display: flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
  .btn {
    padding: 12px 24px; border-radius: 7px; font-family: 'DM Mono', monospace;
    font-size: 13px; font-weight: 500; cursor: pointer; border: none;
    letter-spacing: 0.04em; transition: transform 0.15s, box-shadow 0.15s, opacity 0.15s;
  }
  .btn:hover { transform: translateY(-1px); }
  .btn:active { transform: translateY(0); }
  .btn-primary { background: linear-gradient(135deg,#6030b0,#9060e0); color: #fff; box-shadow: 0 3px 14px rgba(100,50,200,0.3); }
  .btn-primary:hover { box-shadow: 0 6px 20px rgba(100,50,200,0.4); }
  .btn-secondary { background: rgba(255,255,255,0.05); color: var(--text); border: 1px solid var(--border); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  /* Status / output */
  .status { border-radius: 8px; padding: 12px 16px; font-size: 13px; line-height: 1.6; margin-top: 16px; display: none; }
  .status.error { background: rgba(200,60,60,0.1); border: 1px solid rgba(200,60,60,0.3); color: #e08080; }
  .status.success { background: var(--green-dim); border: 1px solid rgba(93,186,122,0.3); color: var(--green); }

  /* How-to steps */
  ol.steps { list-style: none; counter-reset: s; }
  ol.steps li { counter-increment: s; display: flex; gap: 12px; align-items: flex-start; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 13px; color: #b0a89e; line-height: 1.7; }
  ol.steps li:last-child { border-bottom: none; }
  ol.steps li::before { content: counter(s); min-width: 22px; height: 22px; background: var(--purple-dim); border: 1px solid rgba(155,109,255,0.3); color: var(--purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 500; flex-shrink: 0; margin-top: 3px; }

  code { background: rgba(255,255,255,0.06); padding: 1px 6px; border-radius: 3px; font-size: 0.9em; color: #c0b8a8; }
  strong { color: #e8dcc8; }
  footer { margin-top: 60px; padding-top: 24px; border-top: 1px solid var(--border); font-size: 11px; color: var(--muted); letter-spacing: 0.06em; }
</style>
</head>
<body>
<div class="wrap">
  <h1>BotBox ‚Üí Moxfield</h1>
  <p class="tagline">Convert a BotBox "Copy Pack" export to a Moxfield collection CSV</p>

  <!-- Main converter -->
  <div class="card">
    <div class="card-title">‚öóÔ∏è Convert</div>

    <div class="field-label">Pack name (used as filename)</div>
    <input type="text" id="pack-name" placeholder="e.g. LEB - Beta Booster Box" />

    <div class="field-label">Paste your BotBox "Copy Pack" output here</div>
    <textarea id="input" placeholder="1 Air Elemental [leb 47]&#10;2 Ancestral Recall [leb 48]&#10;1 Black Lotus [leb 233]&#10;..."></textarea>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="convert()">Download CSV ‚Üí</button>
      <button class="btn btn-secondary" onclick="clearAll()">Clear</button>
    </div>

    <div class="status" id="status"></div>
  </div>

  <!-- Instructions -->
  <div class="card">
    <div class="card-title">üìã How to use</div>
    <ol class="steps">
      <li>Open your BotBox pack page (e.g. <code>botbox.dev/pack/ABC123...</code>)</li>
      <li>Click the <strong>Copy Pack</strong> button on the page</li>
      <li>Paste the result into the box above (<code>Ctrl+V</code> / <code>Cmd+V</code>)</li>
      <li>Enter a pack name if you'd like ‚Äî it becomes the CSV filename</li>
      <li>Click <strong>Download CSV ‚Üí</strong> and import the file into Moxfield</li>
    </ol>
  </div>

  <!-- Moxfield import -->
  <div class="card">
    <div class="card-title">üì• Importing into Moxfield</div>
    <ol class="steps">
      <li>Go to <a href="https://moxfield.com/collection" target="_blank" style="color:var(--purple)">moxfield.com/collection</a></li>
      <li>Click <strong>Import</strong> in the top right</li>
      <li>Choose <strong>CSV</strong> and upload the downloaded file</li>
      <li>Review and confirm ‚Äî done!</li>
    </ol>
  </div>

  <footer>Not affiliated with BotBox or Moxfield &nbsp;¬∑&nbsp; For personal use only</footer>
</div>

<script>
function convert() {
  var raw = document.getElementById('input').value.trim();
  var packName = document.getElementById('pack-name').value.trim();
  var status = document.getElementById('status');
  status.style.display = 'none';

  if (!raw) {
    showStatus('error', 'Please paste your BotBox "Copy Pack" output first.');
    return;
  }

  // Parse format: "{count} {name} [{set} {collector_number}]"
  // e.g. "2 Ancestral Recall [leb 48]"
  var lines = raw.split('\n').map(function(l){ return l.trim(); }).filter(Boolean);
  var rows = ['Count,Tradelist Count,Name,Edition,Condition,Language,Foil,Tags,Last Modified,Collector Number'];
  var parsed = 0;
  var skipped = [];

  lines.forEach(function(line) {
    // Match: leading number, then name, then [set collector_number] at end
    var m = line.match(/^(\d+)\s+(.+?)\s+\[([a-z0-9]+)\s+(\d+)\]\s*$/i);
    if (!m) {
      // Try without collector number: [set]
      var m2 = line.match(/^(\d+)\s+(.+?)\s+\[([a-z0-9]+)\]\s*$/i);
      if (m2) {
        var name = '"' + m2[2].replace(/"/g, '""') + '"';
        rows.push([m2[1], '', name, m2[3].toLowerCase(), 'Near Mint', 'English', '', '', '', ''].join(','));
        parsed++;
      } else {
        if (line) skipped.push(line);
      }
      return;
    }
    var qty = m[1];
    var name = '"' + m[2].replace(/"/g, '""') + '"';
    var set  = m[3].toLowerCase();
    var num  = m[4];
    rows.push([qty, '', name, set, 'Near Mint', 'English', '', '', '', num].join(','));
    parsed++;
  });

  if (!parsed) {
    showStatus('error', 'Could not parse any cards. Make sure you pasted the BotBox "Copy Pack" output ‚Äî it should look like: <code>1 Black Lotus [leb 233]</code>');
    return;
  }

  // Derive filename
  var filename;
  if (packName) {
    filename = packName.replace(/[\/\\?%*:|"<>]/g, '-') + '.csv';
  } else {
    filename = 'moxfield_import.csv';
  }

  var csv = rows.join('\n');
  var blob = new Blob([csv], { type: 'text/csv' });
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);

  var msg = '‚úì Exported ' + parsed + ' card types to <strong>' + filename + '</strong>';
  if (skipped.length) msg += '<br><span style="opacity:0.7">Skipped ' + skipped.length + ' unrecognised line(s).</span>';
  showStatus('success', msg);
}

function showStatus(type, msg) {
  var el = document.getElementById('status');
  el.className = 'status ' + type;
  el.innerHTML = msg;
  el.style.display = 'block';
}

function clearAll() {
  document.getElementById('input').value = '';
  document.getElementById('pack-name').value = '';
  document.getElementById('status').style.display = 'none';
}
</script>
</body>
</html>
